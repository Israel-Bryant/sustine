<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.shape.Circle?>
<?import javafx.geometry.Insets?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<BorderPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.casaspedro.suporte.controllers.MainController"
            fx:id="rootContainer"
            styleClass="root"
            prefWidth="1280" prefHeight="800"
            stylesheets="@../css/theme.css">

    <!-- HEADER -->
    <top>
        <HBox styleClass="header" alignment="CENTER">
            
            <!-- Logo com Badge Gradiente -->
            <HBox alignment="CENTER_LEFT" spacing="12" minWidth="180">
                <StackPane styleClass="logo-badge">
                    <Label text="CP" styleClass="logo-badge-text"/>
                </StackPane>
                <VBox alignment="CENTER_LEFT" spacing="-2">
                    <Label text="SUPORTE" styleClass="logo-title"/>
                    <Label text="Casas Pedro" styleClass="logo-subtitle"/>
                </VBox>
            </HBox>
            
            <!-- Spacer -->
            <Region HBox.hgrow="ALWAYS"/>
            
            <!-- Search Box Centralizado -->
            <HBox fx:id="searchBox" styleClass="search-box" alignment="CENTER_LEFT" minWidth="450" maxWidth="500">
                <FontIcon iconLiteral="fas-magic" styleClass="search-icon" iconSize="18"/>
                <TextField fx:id="searchField"
                           styleClass="search-field"
                           promptText="Pesquisar com IA... descreva seu problema"
                           HBox.hgrow="ALWAYS"
                           onAction="#onSearch"/>
                <Button fx:id="searchBtn" text="→" styleClass="search-btn" onAction="#onSearch"/>
            </HBox>
            
            <!-- Spacer -->
            <Region HBox.hgrow="ALWAYS"/>
            
            <!-- Placeholder para balancear -->
            <Region minWidth="180"/>
            
        </HBox>
    </top>

    <!-- CONTENT - Chat + Cards with SplitPane -->
    <center>
        <SplitPane fx:id="mainSplitPane" dividerPositions="0.75" styleClass="main-split-pane">
            
            <!-- RIGHT PANEL - CARDS AREA -->
            <VBox fx:id="cardsContainer" alignment="TOP_CENTER" styleClass="cards-panel">
                <padding>
                    <Insets top="60" right="80" bottom="60" left="80"/>
                </padding>
                
                <!-- Título da Seção -->
                <VBox alignment="CENTER" spacing="8">
                    <Label text="Ferramentas" styleClass="section-title"/>
                    <Label text="Selecione uma ferramenta para executar" styleClass="section-desc"/>
                </VBox>
                
                <!-- Cards Grid 2x2 -->
                <GridPane hgap="24" vgap="24" alignment="CENTER" maxWidth="850">
                    <padding>
                        <Insets top="40"/>
                    </padding>
                    
                    <!-- Card 1: Reconectar Pastas -->
                    <VBox fx:id="cardNetwork" styleClass="card" 
                          onMouseClicked="#onCardClick" userData="reconnect-network"
                          GridPane.columnIndex="0" GridPane.rowIndex="0">
                        <HBox alignment="CENTER_LEFT" spacing="16">
                            <StackPane styleClass="card-icon-box">
                                <FontIcon iconLiteral="fas-folder" iconSize="24"/>
                            </StackPane>
                            <VBox spacing="4">
                                <Label text="Reconectar Pastas" styleClass="card-title"/>
                                <Label text="Reconecta unidades de rede" styleClass="card-desc"/>
                            </VBox>
                        </HBox>
                        <Region VBox.vgrow="ALWAYS"/>
                        <Label text="Clique para executar →" styleClass="card-action"/>
                    </VBox>
                    
                    <!-- Card 2: Limpar Cache (Warning - Laranja) -->
                    <VBox fx:id="cardCache" styleClass="card, card-warning" 
                          onMouseClicked="#onCardClick" userData="clear-cache"
                          GridPane.columnIndex="1" GridPane.rowIndex="0">
                        <HBox alignment="CENTER_LEFT" spacing="16">
                            <StackPane styleClass="card-icon-warning">
                                <FontIcon iconLiteral="fas-trash-alt" iconSize="24"/>
                            </StackPane>
                            <VBox spacing="4">
                                <Label text="Limpar Cache" styleClass="card-title"/>
                                <Label text="Remove arquivos temporários" styleClass="card-desc"/>
                            </VBox>
                        </HBox>
                        <Region VBox.vgrow="ALWAYS"/>
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <FontIcon iconLiteral="fas-exclamation-triangle" styleClass="warning-icon" iconSize="14"/>
                            <Label text="Requer reinicialização" styleClass="card-warning-text"/>
                        </HBox>
                    </VBox>
                    
                    <!-- Card 3: Reparar Office -->
                    <VBox fx:id="cardOffice" styleClass="card" 
                          onMouseClicked="#onCardClick" userData="repair-office"
                          GridPane.columnIndex="0" GridPane.rowIndex="1">
                        <HBox alignment="CENTER_LEFT" spacing="16">
                            <StackPane styleClass="card-icon-box">
                                <FontIcon iconLiteral="fas-tools" iconSize="24"/>
                            </StackPane>
                            <VBox spacing="4">
                                <Label text="Reparar Office" styleClass="card-title"/>
                                <Label text="Corrige problemas do MS Office" styleClass="card-desc"/>
                            </VBox>
                        </HBox>
                        <Region VBox.vgrow="ALWAYS"/>
                        <Label text="Clique para executar →" styleClass="card-action"/>
                    </VBox>
                    
                    <!-- Card 4: Manutenção de Planilhas (Featured - Ciano) -->
                    <VBox fx:id="cardPlanilha" styleClass="card, card-featured" 
                          onMouseClicked="#onAbrirPlanilha"
                          GridPane.columnIndex="1" GridPane.rowIndex="1">
                        <HBox alignment="CENTER_LEFT" spacing="16">
                            <StackPane styleClass="card-icon-cyan">
                                <FontIcon iconLiteral="fas-table" iconSize="24"/>
                            </StackPane>
                            <VBox spacing="4">
                                <Label text="Manutenção de Planilhas" styleClass="card-title"/>
                                <Label text="Repara Excel bloqueados" styleClass="card-desc"/>
                            </VBox>
                        </HBox>
                        <Region VBox.vgrow="ALWAYS"/>
                        <Label text="Abrir ferramenta →" styleClass="card-action"/>
                    </VBox>
                    
                    <columnConstraints>
                        <ColumnConstraints hgrow="ALWAYS" percentWidth="50"/>
                        <ColumnConstraints hgrow="ALWAYS" percentWidth="50"/>
                    </columnConstraints>
                </GridPane>
                
            </VBox>
            
            <!-- LEFT PANEL - CHAT AREA -->
            <VBox fx:id="chatContainer" styleClass="chat-panel" visible="false" managed="false">
                <!-- Chat Header com botão fechar -->
                <HBox styleClass="chat-header" alignment="CENTER">
                    <FontIcon iconLiteral="fas-robot" iconSize="16" styleClass="chat-header-icon"/>
                    <Label text="Assistente IA" styleClass="chat-header-title"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button fx:id="btnCloseChat" styleClass="chat-close-btn" onAction="#onCloseChat">
                        <graphic>
                            <FontIcon iconLiteral="fas-times" iconSize="14"/>
                        </graphic>
                    </Button>
                </HBox>
                
                <!-- Mensagens do Chat -->
                <ScrollPane fx:id="chatScrollPane" styleClass="chat-scroll" fitToWidth="true" VBox.vgrow="ALWAYS">
                    <VBox fx:id="chatMessages" styleClass="chat-messages" spacing="12">
                        <padding>
                            <Insets top="16" right="16" bottom="16" left="16"/>
                        </padding>
                    </VBox>
                </ScrollPane>
                
                <!-- Input do Chat -->
                <HBox styleClass="chat-input-area" alignment="CENTER" spacing="12">
                    <padding>
                        <Insets top="12" right="16" bottom="12" left="16"/>
                    </padding>
                    <HBox styleClass="chat-input-box" alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                        <FontIcon iconLiteral="fas-comment-dots" styleClass="chat-input-icon" iconSize="16"/>
                        <TextField fx:id="chatInput"
                                   styleClass="chat-input-field"
                                   promptText="Digite sua mensagem..."
                                   HBox.hgrow="ALWAYS"
                                   onAction="#onSendMessage"/>
                        <Button fx:id="chatSendBtn" styleClass="chat-send-btn" onAction="#onSendMessage">
                            <graphic>
                                <FontIcon iconLiteral="fas-paper-plane" iconSize="14"/>
                            </graphic>
                        </Button>
                    </HBox>
                </HBox>
            </VBox>
            
        </SplitPane>
    </center>

    <!-- FOOTER -->
    <bottom>
        <HBox styleClass="footer" alignment="CENTER">
            <!-- Status do Servidor -->
            <HBox alignment="CENTER_LEFT" spacing="10">
                <StackPane fx:id="serverStatusContainer">
                    <Circle fx:id="serverStatusGlow" radius="6" styleClass="status-glow"/>
                    <Circle fx:id="serverStatusDot" radius="5" styleClass="status-dot"/>
                </StackPane>
                <Label fx:id="serverLabel" text="Servidor: \\10.254.1.236" styleClass="footer-text">
                    <tooltip>
                        <Tooltip fx:id="serverTooltip" text="Verificando..."/>
                    </tooltip>
                </Label>
            </HBox>
            <Region HBox.hgrow="ALWAYS"/>
            <Label text="v3.0" styleClass="footer-version"/>
        </HBox>
    </bottom>

</BorderPane>
